<html>

<head>
    <META HTTP-EQUIV="refresh" CONTENT="1">
</head>

<h1>Documentation and acceptance test for a html publisher</h1>

<p> This is the documentation and acceptance tests for a html publisher. The purpose with the html publisher os to allow a text written in html include source code that is properly formatted for html. Source code may be Java, xml, html, xhtml and so on. This document will act both as documentation of the tool and as an acceptance test document. It will contain the specific includes that should be handled properly as well as being used for the transformation. </p>

<!--more-->

<p> A key feature is that the html should be formatted so no unnecessary line breaks are included in the transformed result. This is needed so Wordpress doesn't break a paragraph written in html just because a pretty code formatter did that. </p>

<h2>Comments</h2>

<p> Html comments should be respected in the sense that no transformation should be done inside of a comment. The comment should just be passed through the transformer without any changes in its formatting. An example may look like this: </p>

<!--
    This is a html comment that should be passed through the transformer verbatim. No changes should be done.

-->

<h2>Lists</h2>

<p> Lists should be treated as paragraphs in the sense that any line breaks should not be included. Very long list items should be transformed so that they have there start tag and end tag on the same line. An example may look like: </p>

<ul>
    <li>This is a long list item that has been divided into more then one line in the source but should not be divided in the transformed result. </li>
</ul>

<ol>
    <li>This is another long list item that has been divided into more then one line in the source but should not be divided in the transformed result. </li>
</ol>

<h2>Includes</h2>

<p> The most important feature is including files. The include is defined with an include tag at the beginning of a row in the tml document. It should not be part of any tag, except the html and possible the body tag. The result should be a pre tag with the file properly transformed. The transformation should only be done for characters that has a special meaning in html. A typical example is '&gt;' in xml that has to be transformed. </p>

<p> The different includes that are supported are these: </p>

<p> Simple file include: </p>

<pre>
&lt;include-source-code root="./acceptance-test"
         file="./src/test/java/se/somath/publisher/AcceptanceTest.java"/&gt;
</pre>

<p> And the result is: </p>

<p><i>./src/test/java/se/somath/publisher/AcceptanceTest.java</i></p>
<pre>
<div style="border: 1px inset; padding: 15px;">
package se.somath.publisher;

import org.apache.commons.io.FileUtils;
import org.apache.commons.io.LineIterator;
import org.junit.Test;

import java.io.*;
import java.util.Collection;

import static org.hamcrest.CoreMatchers.is;
import static org.junit.Assert.assertFalse;
import static org.junit.Assert.assertThat;

public class AcceptanceTest {

    @Test
    public void shouldVerifyThatProcessedFileIsEqualToExpected() throws IOException {
        String targetFileName = getActualFileName();
        String expectedFileName = getExpectedFileName();

        assertFileContentLineForLine(expectedFileName, targetFileName);
    }

    private String getActualFileName() {
        Collection&lt;File&gt; htmlFiles = getAllHtmlFiles();
        String wantedFileName = &quot;target/index.html&quot;;

        return findFile(htmlFiles, wantedFileName);
    }

    private String getExpectedFileName() {
        Collection&lt;File&gt; htmlFiles = getAllHtmlFiles();
        String wantedFileName = &quot;resources/expected-index.html&quot;;

        return findFile(htmlFiles, wantedFileName);
    }

    private void assertFileContentLineForLine(String expectedFile, String actualFile) throws FileNotFoundException {
        Reader actualReader = new FileReader(actualFile);
        Reader expectedReader = new FileReader(expectedFile);

        LineIterator actualIterator = new LineIterator(actualReader);
        LineIterator expectedIterator = new LineIterator(expectedReader);

        assertEachLine(actualFile, actualIterator, expectedIterator);
        assertFalse(&quot;The actual and target files has different length&quot;, expectedIterator.hasNext());
    }

    private Collection&lt;File&gt; getAllHtmlFiles() {
        File currentDir = new File(&quot;.&quot;);
        String[] extensions = {&quot;html&quot;};
        boolean recursive = true;

        return FileUtils.listFiles(currentDir, extensions, recursive);
    }

    private String findFile(Collection&lt;File&gt; htmlFiles, String wantedFileName) {
        for (File candidateFile : htmlFiles) {
            if (candidateFile.getAbsolutePath().endsWith(wantedFileName)) {
                return candidateFile.getAbsolutePath();
            }
        }

        return &quot;file not found&quot;;
    }

    private void assertEachLine(String actualFile, LineIterator actualIterator, LineIterator expectedIterator) {
        int lineNumber = 0;
        while (actualIterator.hasNext()) {
            lineNumber++;
            String errorMessage = &quot;\nsource file: &quot; + actualFile + &quot; \nline number: &quot; + lineNumber;
            String actual = actualIterator.nextLine().trim();
            String expected = expectedIterator.nextLine().trim();

            assertThat(errorMessage, actual, is(expected));
        }
    }
}
</div>
</pre>

<p> Including a method from a file is done like this: </p>

&lt;include-source-code root="./acceptance-test"
         file="src/test/java/se/somath/publisher/AcceptanceTest.java"
         method="public void shouldVerifyThatProcessedFileIsEqualToExpected()"
         displayFileName="false"/&gt;


<p> And the result is: </p>


<pre>
<div style="border: 1px inset; padding: 15px;">
@Test
public void shouldVerifyThatProcessedFileIsEqualToExpected() throws IOException {
    String targetFileName = getActualFileName();
    String expectedFileName = getExpectedFileName();

    assertFileContentLineForLine(expectedFileName, targetFileName);
}
</div>
</pre>

<p> You can include a file tree like this: </p>

<pre>
&lt;include-file-tree root="./acceptance-test"/&gt;
</pre>

<p> And the result is: </p>

<pre>
acceptance-test
|-- pom.xml
`-- src
    |-- main
    |   `-- resources
    |       `-- index.html
    `-- test
        |-- java
        |   `-- se
        |       `-- somath
        |           `-- publisher
        |               `-- AcceptanceTest.java
        `-- resources
            `-- expected-index.html
</pre>

<h2>Pre and code</h2>

<p> Pre and code tags should not be transformed at all, they should be treated as pass through without any alterations at all. </p>

<h2>Resources</h2>

<ul>
    <li><a href="http://thomassundberg.wordpress.com/about/">Thomas Sundberg</a> - the author</li>
</ul>

</html>